<!DOCTYPE html>
<!--
Author: Ben Connick
-->
<html>
    <head>
        <title>S&D 0.0.4</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
		<!--<link href='https://fonts.googleapis.com/css?family=IM Fell English SC' rel='stylesheet' type='text/css'>-->
        <link href='https://fonts.googleapis.com/css?family=IM Fell English SC' rel='stylesheet' type='text/css'>
        <style>
        	body {
        		background-color: #000020/*#BBDDFF*/;
        		background-image: url("images/yellow-canvas-tiling.png");
        		background-repeat: repeat-both;
        		max-width: 400px;
        		font-size: 12pt;
        	}
        	h1 {
        		font-size: 2.3em;
        		font-family: "IM Fell English SC";
        		margin-left: 0.2em;
        		color: white;
        		text-shadow: 0.0em 0.0em 0.1em black; 
        	}
        	h2 {
				color: #000020;
				font-size: 1.2em;
				font-family: "IM Fell English SC";
				background-color: rgba(255,255,255,0.5);
				padding-left: 0.5em;
				margin-top: 0.5em;
				padding-top: 0.5em;
				margin-bottom: 0.5em;
				padding-bottom: 0.5em;
			}
        	h4 {
        		border-top: 2px solid;
        		font-family: "IM Fell English SC";
        		font-size: 1.2em;
        		margin-bottom: 0.5em;
        	}
        	h5 {
        		font-family: "IM Fell English SC";
        		font-size: 1.7em;
        		margin-top: 1em;
        		margin-bottom: 1em;
        	}
        	button {
        		font-size: 1em;
        	}
        	button:hover {
        		cursor: pointer;
        	}
        	.topSpacer {
        		width: 100%;
        		height: 1em;
        		display: block;
        	}
        	.topBar {
        		display: block;
        		border-radius: 0pt 0pt 5pt 5pt;
        		border: solid 1pt grey;
        		background-color: rgba(0,0,0,0.8);
        		color: #ddd;
        		width: 98%;
        		height: 50em;
        		position: fixed;
        		top: -51em;
        		left: 0px;
        		margin-left: 1%;
        		font-size: 12pt;
        		transition: top 0.2s;
        		z-index: 100;
        	}
        	.bottomBar {
        		padding: 1em;
        		display: block;
        		border-radius: 5pt 5pt 0pt 0pt;
        		border: solid 1pt grey;
        		background-color: rgba(0,0,0,0.8);
        		color: #ddd;
        		width: 88%;
        		height: 6em;
        		position: fixed;
        		bottom: -11em;
        		left: 0px;
        		margin-left: 1%;
        		font-size: 12pt;
        		transition: bottom 0.1s;
        	}
        	#rollCalculation {
        		margin: 0pt;
        	}
        	.closeBottomBarButton {
        		font-family: sans-serif;
        		/*border-radius: 2pt;
        		border: solid 1px;
        		border-color: #888;*/
        		color: #888;
        		width: 1em;
        		height: 0.8em;
        		padding-bottom: 0.2em;
        		position: absolute;
        		right: 0.5em;
        		top: 0.5em;
        		text-align: center;
        	}
        	.closeBottomBarButton:after{
			  content: "\00d7"; /* This will render the 'X' */
			}
        	.closeBottomBarButton:hover {
        		background-color: #888;
        		border-color: white;
        		color: white;
        	}
        	.classTab {
        		border-radius: 0pt 0pt 5pt 0pt;
        		border: solid 1pt grey;
        		background-color: rgba(0,0,0,0.9);
        		color: #ddd;
        		width: 88%;
        		height: 3.2em;
        		position: fixed;
        		top: -0.04em;
        		left: 10%;
        		margin-left: 1%;
        		font-size: 12pt;
        		display: none;
        	}
        	.topBtn:hover { 
        		background-color: white;
        	}
        	.moveBox {
        		background-color: rgba(255,255,255,0.6);
        		border-radius: 0pt;
        		border: solid 1px black;
        		height: contents;
        		width: calc(95%-40pt);
        		margin: 2pt auto;
        		padding: 0em;
        	}
        	.innerMoveBox {
        		padding-left: 0.5em;
        		padding-right: 0.5em;
        		background-color: rgba(255,255,255,0.6);
        		/*border-radius: 1pt;*/
        		/*border: solid 1px black;*/
        		height: 0;
        		overflow: hidden;
        		width: calc(95%-40pt);
        		transition: height 0.5s;
        	}
        	.moveName {
        		font-size: 125%;
        		font-weight: 600;
        		text-align: left;
        		margin: 1pt;
        		margin-left: 4pt;
				font-family: "IM Fell English SC";
				display: inline;
        	}
        	.roll {
        		text-align: left;
        	}
        	.roll-attacker {
        		color: green;
        	}
        	.roll-defender {
        		color: blue;
        	}
        	.damage {
        		color: #CC0000;
        	}
        	.effect {
        		text-align: left;
        	/**/
        	}
        	.AP {
        		border: solid darkblue;
				border-width: 1pt;
        		border-radius: 50000pt;
        		/* Hide this element in this version */
        		position: absolute;
        		display: none;
        		width: 100%;
        		text-align: center;
        		margin-top: 0.25em;
        		font-weight: bold;
        		color: darkblue;
				background-color: rgba(255,255,255,0.5);
				font-family: "IM Fell English SC";
				font-size: 1.5em;
        	}
        	.circle {
        		width: 2em;
        		height: 2em;
        		/*border: solid 2pt darkblue;
        		border-radius: 10000pt;*/
        		display: inline-block;
        		margin-right: 10%;
        	}
        	.APbox {
        		/*padding-bottom: 10%;*/
        		float: right;
        	}
        	.flavor {
        		text-align: left;
        		font-style: italic;
        	}
        	.headerBar {
        		text-align: center;
        	}
        	.headerBar > span {
        		padding-left: 10pt;
        		padding-right: 10pt;
        	}
        	.addBtn {
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.5);
        		color: #009;
        		padding: 0.4em;
        		margin-top: 0.5em;
        		font-family: "IM Fell English SC";
        		font-size: 1em;
        	}
        	.useBtn {
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.5);
        		color: #009;
        		margin: 0.1em;
        		margin-top: 0.3em;
        		font-size: 1em;
        		display: inline-block;
        	}
			.categoryLabel {
				margin-top: 0.4em;
				font-size: 1.1em;
				color: rgba(0,0,0,0.5);
				text-decoration: underline;
			}
        	.navBtn {
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.9);
        		color: #009;
        		padding: 0.4em;
        		float: right;
        		margin-right: 6pt;
        		margin-top: 10pt;
        		font-family: "Times";
        		position: absolute;
        	}
        	.optionBtn {
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.9);
        		color: #009;
        		padding: 0.4em;
        		float: right;
        		font-family: "Times";
        		position: absolute;
        		font-size: 200%;
        		width: 90%;
        		left: 5%;
        		font-family: "IM Fell English SC";
        	}
        	.optionsBtn {
        		right: 0.3em;
        		bottom: 0.4em;
        		display: none;
        	}
        	.hideBtn {
        		right: 0.3em;
        		bottom: 0.4em;
        	}
        	.resetBtn { 
        		right: 5.1em;
        		bottom: 0.4em;
        	}
        	.plusOneBtn { 
        		right: 9em;
        		bottom: 0.4em;
        	}
        	.minusOneBtn { 
        		right: 11.8em;
        		bottom: 0.4em;
        	}
        	.myMovesBtn {
        		background-color: rgba(100,255,100,0.9);
        		top: 11.8em;
        	}
        	.allMovesBtn {
        		top: 14.1em;
        	}
        	.mainMenuBtn {
        		top: 16.4em;
        	}
        	.helpBtn {
        		top: 18.7em;
        	}
        	.characterBtn {
        		top: 21em;
        		background-color: rgba(210,210,255,0.9);
        	}
        	.APCounter {
        		display: inline-block;
        		font-size: 150%;
        		font-family: "Times";
        		position: absolute;
        		bottom: -0.6em;
        		left: 0.6em;
        	}
        	.topRow {
        		display: inline-block;
        		margin-bottom: 0.4em;
        		width: calc(100% - 6.5em);
        	}
        	.choice {
        		font-size: 90%;
        		width: 8.25em;
        		height: 3em;
        		margin: 0.1em;
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.5);
        		color: black;
        		float: left;
        	}
        	.skill {
        		width: 10.5em;
        		height: 2em;
        		padding-top: 1em;
        		padding-left: 1em;
        		margin: 0.1em;
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.5);
        		color: black;
        		float: left;
        	}
        	.score {
        		width: 1.5em;
        		height: 2em;
        		padding-top: 1em;
        		padding-left: 1em;
        		margin: 0.1em;
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.5);
        		color: black;
        		float: right;
        	}
        	.decrementSkillBtn {
        		width: 2em;
        		height: 3em;
        		margin: 0.1em;
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.5);
        		color: black;
        		float: right;
        	}
        	.incrementSkillBtn {
        		width: 2em;
        		height: 3em;
        		margin: 0.1em;
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.5);
        		color: black;
        		float: right;
        	}
        	.superChoice {
        		width: 8.5em;
        		height: 6.2em;
        	}
        	.checked {
        		color: #AAFFAA;
        	}
        	.characterCreationBox {
        		display: none;
        		padding: 1.5em;
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.5);
        		color: black;
        		max-width: 20em;
        		border-width: 0.15em;
        		border: solid rgba(0,0,143,1);
        		margin-bottom: 1em;
        	}
        	.ccTitle {
        		margin-top: 0px;
        		background-color: rgba(255,255,255,0.7);
				padding: 0.5em;
        		padding-top: 1em;
        		padding-bottom: 1em;
        		border-radius: 0.4em;
        		font-weight: bold;
        		font-size: 100%;
        		width: 90%;
        		text-align: center;
				font-family: "IM Fell English SC";
        	}
        	#done {
        		padding: 0.5em;
        		margin-top: 0.5em;
        		margin-bottom: 0.2em;
        		margin-left: 6em;
        		margin-right: 4em;
        		border-radius: 0.3em;
        		border-width: 0.15em;
        	}
        	.bigButton {
        		width: 95%;
        		margin: 2pt auto;
        		border-radius: 0.3em;
        		border-width: 0.15em;
        		border: solid rgba(0,0,143,1);
        		background-color: rgba(255,255,255,0.8);
        		color: rgba(0,0,143,1);
        		font-size: 1.2em;
				font-family: "IM Fell English SC";
				font-weight: bold;
        	}
        	#ccStartBtn {
        		padding: 1.5em;
        	}
        	#loadBtn {
        		padding: 1em;
        	}
        	#saveBtn {
        		padding: 1em;
        	}
        	#aboutBtn {
        		padding: 1em;
        	}
        	.highlight {
        		background-color: rgba(0,255,0,0.5);
        		color: rgba(0,0,143,1);
        	}
        	.incomplete {
        		border: solid rgba(0,0,143,0.5);
        		background-color: rgba(0,0,0,0.2);
        		color: rgba(0,0,143,0.5);
        	}
        	.complete {
        		border: solid rgba(0,0,143,1);
        		background-color: rgba(255,255,255,0.5);
        		color: rgba(0,0,143,1);
        	}
        	.bar {
        		height: 1em;
        		background-color: green;
        		float: left;
        		margin-right: 0.2em;
        	}
        	.d4 {
        		width: 4em;
        	}
        	.d6 {
        		width: 6em;
        	}
        	.d8 {
        		width: 8em;
        	}
        	.d10 {
        		width: 10em;
        	}
        	.myCharacterBox {
        		display: none;
        		padding-top: 0.5em;
        		padding-bottom: 0.5em;
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.5);
        		color: #009;
        		max-width: 23em;
        	}
        	.FourEmSquare {
        		width: 4em;
        		height: 4em;
        	}
        	.centerAligned { 
        		text-align: center;
        	}
        	.doubleFontSize {
        		font-size: 200%;
        	}
        	.oneAndAHalfFontSize { font-size: 150%; }
        	#characterPicture {
        		width: 14em;
        		border-radius: 10000px;
        		border: solid black;
        		border-width: 1px;
        		background-color: rgba(255,255,255,0.3);
        		position: absolute;
				left: calc(50% - 6.5em);
				top: 1em;
				z-index: 0;
        	}
        	#characterPictureContainer {
				position: relative;
        	}
        	.innerCentered {
        		margin: 0 auto;
        		max-width: 15.6em;
        	}
        	.weaponImg {
        		height: 8em;
        	}
        	#bigFourTable td {
        		width: 50%;
        		font-size: 50%;
        	}
        	#skillTable {
        		max-width: 100%;
        		margin: 0 auto;
        		margin-top: 2em;
        		border-collapse: collapse;
        		display: none;
        	}
        	#skillTable td {
        		padding: 1em;
        		border: 1px solid #000080;
        	}
        	.helpBox {
        		display: none;
        		padding: 1em;
        		margin: 0 auto;
        		border-radius: 0.3em;
        		background-color: rgba(255,255,255,0.8);
        		max-width: 23em;
        	}
        	.statusName {
        		width: 2em;
        	}
        	.statusTable {
        		border-collapse: collapse;
        	}
        	.statusTable td, .statusTable tr {
        		border-bottom: 1px solid #000081;
        		margin: 0px;
        		padding: 0.2em;
        	}
			.classPanel {
				width: calc(100%-1em);
				background-color: rgba(0,0,255,0.1);
				/*border: solid rgba(0,0,143,1);*/
				margin: 1em;
			}
			.classButton {
				padding: 0.1em;
				width: 6.1em;
				height: 3em;
				font-size: 0.8em;
			}
			.classImg {
				display: block;
				width: 100%;
				margin: 0px;
			}
			.classPanel .choice {
				float: left;
				position: static;
				font-family: "IM Fell English SC";
				font-size: 60%;
				padding: 0px;
				width: 30%;
				height: 7.5em;
				overflow: hidden;
			}
			.Passive { 
				background-color: rgba(255,255,100,0.8);
			}
			.Instant {
				background-color: rgba(255,100,100,0.8);
			}
			#loadButtons {
				display: none;
			}
			textarea {
				width: 90%;
				height: 10em;
			}
			#saveArea {
				display: none;
			}
			#saveText {
				word-wrap: break-word; 
				background-color: rgba(255,255,255,0.6);
				padding: 0.5em;
			}
			.halfEmPad {
				padding: 0.5em;
			}
			#mobileDebug {
				display: none;
				max-height: 20em;
				overflow-y: scroll;
			}
			#aboutSection {
				max-width:100%;
				padding:1em;
				display:none;
				background-color: rgba(255,255,255,0.6);
			}
			.Q {
				font-weight: bold;
			}
			.A {
			
			}
			.backButton { 
				font-family: Times;
				font-size: 2em;
				color: white;
				position: fixed;
				left: 0.5em;
				top: 0.15em;
				text-shadow: 0.05em 0.05em 0.2em black;
				z-index: 10;
				cursor: pointer;
			}
			.backButton:hover {
				color: #CCC;
			}
			.backDisabled {
				color: rgba(255,255,255,0.2);
				text-shadow: 0.05em 0.05em 0.2em rgb(0,0,0,0.2);
			}
			.threeBars {
				position: fixed;
				width: 2em;
				right: 1em;
				top: 1em;
				z-index: 10;
				cursor: pointer;
			}
			.threeBars .bar {
				width: 1.8em;
				height: 0.2em;
				margin-bottom: 0.3em;
				background-color: white;
				box-shadow: 0.05em 0.05em 0.2em black;
			}
			.threeBars:hover .bar {
				background-color: #CCC;
			}
			#attributeTable {
				text-align: center;
				width: 18em;
				margin: 0 auto;
				margin-bottom: 1em;
			}
			#attributeTable td {
			}
			.middleRowSpacer {
				height: 12em;
			}
			.middleColSpacer {
				width: 8em;
			}
			#choiceDescriptionText {
				margin-top: 1em;
			}
			.classPic {
				width: 95%;
			}
			.tableSectionHeader {
				text-align: center;
				height: 1em; 
				padding-top: 1.5em; 
				padding-bottom: 1em;"
			}
			.tableSectionHeader span {
				font-size: 150%;
				font-family: "IM Fell English SC";
				color: #0d5d0d;
			}
			.characterName {
				font-size: 2em;
				text-align: center;
				margin-top: 0.6em;
				margin-bottom: 0.1em;
				font-family: "IM Fell English SC";
				color: #0d5d0d;
			}
			.characterClass { 
				font-size: 1em;
				text-align: center;
				margin-bottom: 0.8em;
				font-family: "IM Fell English SC";
			}
			.wepDamage {
				color: red;
				font-size: 120%;
			}
			.notes {
				height: 1.5em; 
				display: block; 
				margin: 0 auto; 
				background-color: rgba(255,255,255,0.5);
			}
			.q {
				overflow: hidden;
			}
			.link {
				color: blue;
				cursor: pointer;
			}
			#helpLink {
				color: blue;
				cursor: pointer;
			}
			.quickstart {
				background-color: #B8CCCC;
				padding: 0.5em;
				margin-top: 5em;
			}
			.helpTitleBackground {
				/*background-color: #FF0000;
				box-shadow: 0pt 0pt 3pt 3pt #FF0000;*/
			}
			.helpfulHint {
				background-color: rgba(255,255,255,0.5);
				border-radius: 0.5em;
				padding: 0.5em;
				display: none;
			}
			.definitionBox {
				border-radius: 0.25em;
				border: 1pt solid #000;
				position: fixed;
				width: 23em;
				bottom: -30em;
				left: 0.5em;
				margin: 0px;
				padding: 1em;
				background-color: #FFF;
				text-align: justify;
				max-width: calc(100% - 3em);
				-webkit-transition: bottom 0.2s; /* Safari */
				transition: bottom 0.2s;
			}
			.defNavBar {
				position: absolute;
				border-radius: 0.25em 0.25em 0em 0em;
				left: 0;
				top: 0;
				background-color: lightgray;
				width: calc(100% - 1em);
				padding: 0.5em;
			}
			.definitionHeader {
				position: absolute;
				left: 15%;
				z-index: 0;
				text-align: center;
				width: 70%;
			}
			.defBody {
				margin-top: 2em;
				margin-bottom: 2em;
			}
			.defNavBtn {
				display: inline;
				padding-right: 1em;
				cursor: pointer;
				float: left;
				z-index: 3;
			}
			.dieSize1 { 
			padding-top: 0.25em; 
			height: 2.5em;
			vertical-align: text-bottom;
			}
			.keyword {
				color: #00B;
				cursor: pointer;
				text-decoration: underline;
			}
			#nameField { font-size: 1em; }
			#primaryWeaponDamage { display: inline; }
			#secondaryWeaponDamage { display: inline; }
			.battleBox {
				margin: 1em;
				border: solid 1pt;
			}
			.battleHUD {
				display: none;
			}
			.HPButton {}
			.leftBox { 
				display: inline-block; 
				border: solid 1pt; 
			}
			.rightBox {
				display: inline-block; 
				border: solid 1pt;
			}
			.initiativeButtons {
				border: solid 1pt;
			}
			#HPplus {}
			#HPminus {}
			.HPCounter { width: 5em; }
			.BBAPCounter { display: inline; width: 5em; }
			#nextTurn {}
			#movesContainer {}

        </style>
    </head>
    <body>
    	<div class="topSpacer"></div>
    	<div class="bottomBar">	
    		<p id="rollCalculation">This ability automatically succeeds.</p>
    		<div class="closeBottomBarButton"></div>
    	</div>
    	<div class="fixedUI">
    		<div class="backButton backDisabled"> < </div>
    		<div class="threeBars">
    		<div class="bar"></div>
    		<div class="bar"></div>
    		<div class="bar"></div>
    	</div>
    	</div>
    	<div class="topBar">
    		<!--<button class="optionBtn myMovesBtn">My Moves</button>-->
    		<button class="optionBtn allMovesBtn">All Moves</button>
    		<button class="optionBtn mainMenuBtn">Main Menu</button>
    		<button class="optionBtn helpBtn">Help</button>
    		<button class="optionBtn characterBtn">Character</button>
    		<button class="navBtn optionsBtn">Options</button>
    		<button class="navBtn plusOneBtn">+1</button>
    		<button class="navBtn minusOneBtn">-1</button>
    		<button class="navBtn resetBtn">Max</button>
    		<button class="navBtn hideBtn">Hide</button>
    		<p class="APCounter">10AP</p>
    	</div>
    	<div id="mainMenu">
    		<h1>Smartphones & Dragons</h1>
    		<button id="ccStartBtn" class="bigButton complete">Create a Character</button>
    		<button id="saveBtn" class="bigButton incomplete">Export Character</button>
    		<button id="loadBtn" class="bigButton complete">Import Character</button>
    		<button id="aboutBtn" class="bigButton complete">About</button>
    	</div>
    	<div id="loadButtons">
    		<h2 class="">Load</h2>
    		<button id="cookieLoadBtn" class="bigButton complete halfEmPad">Load [class] on [date]</button>
    		<h2 class="">or</h2>
    		<textArea></textArea>
    		<button id="textLoadBtn" class="bigButton complete">Load From Text Box</button>
    	</div>
    	<div id="saveArea">
    		<button id="clipboardBtn">Copy to Clipboard</button>
    		<p id="saveText"></p>
    	</div>
    	<div id="aboutSection">
    		<p>FAQ</p>
			<br>
    			<div class="Q">What is this?</div>
    			<div class="A">This is a webapp interface for a 
    			<a href="http://learntabletoprpgs.com/tabletop-rpgs-explained/index.html">
    			tabletop roleplaying game</a> called <i>Smartphones and Dragons</i> 
    			(name subject to change).</div>
    		<br>
    		<div class="Q">Where are the rules to this game?</div>
    		<div class="A">The <span class="link" id="helpLink">help</span> section.</div>
			<br>
    			<div class="Q">Do I play this game on the computer?</div>
    			<div class="A">This is a Hybrid game. You use this 
    			webapp on your smartphone to organize the game content and to do the math
    			 for you. The actual game is played face-to-face with other people.</div>
			<br>
    			<div class="Q">Can I play this game by myself?</div>
    			<div class="A">No, you need at least two people to play, and at least 
    			four to really get the experience.</div>
			<br>
    			<div class="Q">Is this an online multiplayer game?</div>
    			<div class="A">No, this game is meant to be played face-to-face. 
    			All of the characters you make here are stored locally. </div>
			<br>
				<div class="Q">Can I use this web-app for other role playing systems?</div>
    			<div class="A">You can try, but this interface is designed specifically 
    			for <i>Smartphones and Dragons</i>, or more accurately, <i>Smartphones 
    			and Dragons</i> was designed in conjunction with this web-app.</div>
			<br>
    			<div class="Q">Q?</div>
    			<div class="A">A.</div>

    	</div>
    	<div class="characterCreationBox">
			<p class="ccTitle">Create a Character</p>
			<div class="innerCentered">
				<!-- Character Class -->
				<div id="q1" class="q" style="display: none;"></div>
				<!-- Skills -->
				<div id="q2" class="q" style="display: none;"></div>
				<!-- Moves (empty) -->
				<div id="q3" class="q" style="display: none;"></div>
				<!-- Name -->
				<div id="q4" class="q" style="display: none;">
					<input type="text" style="width:100%;" id="nameField" value="Name">
				</div>
				<div id="choiceDescriptionContainer">
					<p id="choiceDescriptionText"></p>	
				</div>
				<button id="done" class="incomplete" disabled>Next</button>
    		</div>
    	</div>
    	<div class="myCharacterBox">
    		<div class="characterName">Name</div>
    		<div class="characterClass">Class</div>
    		<div class="centerAligned" id="characterPictureContainer">
    		<table id="attributeTable">
    			<tr>
					<td>Strength</td><td class="middleColSpacer">&nbsp&nbsp&nbsp&nbsp</td><td>Agility</td>
				</tr>
				<tr>
					<td class="str"></td><td class="middleColSpacer"></td><td class="agl"></td>
    			</tr>
    			<tr>
    				<td colSpan=3 class="middleRowSpacer"></td>
    			</tr>
				<tr>
					<td>Intelligence</td><td class="middleColSpacer"></td><td>Spirit</td>
				</tr>
				<tr>
					<td class="int"></td><td class="middleColSpacer"></td><td class="spi"></td>
				</tr>
    			<img id="characterPicture" src="images/Slayer.png"/>
    			</table>
    		</div>
    		<table id="bigFourTable" style="width:100%; font-size: 200%;">
    			<tr> <!--spacer-->
    				<td colspan="2" class="tableSectionHeader"><span>Damage</span></td>
    			</tr>
    			<tr>
					<td class="centerAligned">
						<img class="weaponImg" id="primaryWeaponImg">
					</td>
					<td class="centerAligned">
						<img class="weaponImg" id="secondaryWeaponImg">
					</td>
    			</tr>
    			<tr>
					<td class="centerAligned">
						<div id="primaryWeaponName">Sword</div>
					</td>
					<td class="centerAligned">
						<div id="secondaryWeaponName">Bow</div>
					</td>
    			</tr>
    			<tr>
					<td class="centerAligned">
						<img id="weapon1Die" class="dieSize1" src="images/perspective-dice-six-faces-six.png">
						<div id="primaryWeaponDamage" class="doubleFontSize">8</div>
					</td>
					<td class="centerAligned">
						<img id="weapon2Die" class="dieSize1" src="images/perspective-dice-six-faces-six.png">
						<div id="secondaryWeaponDamage" class="doubleFontSize">5</div>
					</td>
    			</tr>
    			
    			<tr> <!--spacer-->
    				<td colspan="2" class="tableSectionHeader"><span>Defenses</span></td>
    			</tr>
    			
    			<tr>
					<td class="centerAligned">
						<img class="FourEmSquare" src="images/shield.png"/>
					</td>
					<td class="centerAligned">
						<img class="FourEmSquare" src="images/armour.png"/>
					</td>
    			</tr>
    			<tr>
					<td class="centerAligned">
						<div>Defense</div>
					</td>
					<td class="centerAligned">
						<div>Hit Points</div>
					</td>
    			</tr>
    			<tr>
					<td class="centerAligned">
						<div id="defenseStat" class="doubleFontSize">16</div>
					</td>
					<td class="centerAligned">
						<div id="damageThresholdStat" class="doubleFontSize">13</div>
					</td>
    			</tr>
    			
    		</table>
    		<table id="skillTable">
    			<tr>
    				<td>Smithing and Appraisal</td><td class="SA">0</td>
    			</tr>
    			<tr>
    				<td>Acrobatics and Athletics</td><td class="AA">0</td>
    			</tr>
    			<tr>
    				<td>Performance and Bluff</td><td class="PB">0</td>
    			</tr>
    			<tr>
    				<td>Alchemy and Cooking</td><td class="AC">0</td>
    			</tr>
    			<tr>
    				<td>Thievery and Sneaking</td><td class="TS">0</td>
    			</tr>
    			<tr>
    				<td>Survival and Tracking</td><td class="ST">0</td>
    			</tr>
    		</table>
    		<div style="text-align: center; margin-top: 1em;">Notes (does not save)</div>
    		<textarea class="notes"></textarea>
    		<div class="battleBox">
				<p class="tableSectionHeader">Battle</p>
				<div class="initiativeButtons">
					<button id="IAttack">I Attack</button>
					<button id="GotAttacked">Got Attacked</button>
				</div>
				<div class="battleHUD">
					<div class="leftBox">
						<button id="HPplus">+</button>
						<div class="HPCounter">10 HP</div>
						<button id="HPminus">-</button>
					</div>
					<div class="rightBox"> 
						<div class="BBAPCounter">10 AP </div>
						<button id="NextTurn">Start/End Turn</button>
					</div>
				</div>
				
				<div id="movesContainer"></div>
    		</div>
    	</div>
    	<div class="helpBox">
			<h1 style="text-align: center; color: rgb(80, 80, 128); text-shadow: none;">Rules and Help</h1>
			<div class="tableOfContents">
			<p>Jump To:</p>
			<ol>
				<li><a href="#introductionH">Introduction</a></li>
				<li><a href="#expectationsH">Expectations</a></li>
				<li><a href="#materialsH">What You Need to Play</a></li>
				<li><a href="#gettingStartedH">Getting Started</a></li>
				<li><a href="#settingH">The Setting</a></li>
				<li><a href="#adventuringH">Adventuring</a></li>
				<li><a href="#criticalH">Critical</a></li>
				<li>
					<a href="#combatH">Combat</a>
					<ul>
						<li><a href="#howToAttackH">How to Attack Stuff</a></li>
						<li><a href="#abilitiesH">Abilities</a></li>
						<li><a href="#statusesH">Statuses</a></li>
						<li><a href="#statusEffectsH">List of statuses.</a></li>
						<li><a href="#combatExampleH">Combat Example</a></li>
					</ul>
				</li>
				<li><a href="#quickReference">Quick Reference</a></li>
			</ol>
			</div>
			<div class="contents">
			<h2 id="introductionH">Introduction</h2>
			No one reads an instruction manual to play Angry Birds. So why should tabletop roleplaying games, which are an extension of the imagination games that we all played as kids, be so hard to learn?

			<br><br>What if the boring parts, the searching for tables and assisting with character creation, were handled for the new players by the computer? 

			<br><br>What if players could create characters in a couple of minutes, instead of a couple of hours? 

			<br><br>What if everyone knew exactly what actions they could take during combat, and were ready when their turn came around?  

			<br><br>What if you could actually harness the power of bored players looking at their smartphones on other players’ turns? 

			<br><br>Well, that is what this rule set and its sibling web-app hope to accomplish.


			<br><br><h2 id="expectationsH">What Should I Expect?</h2>
			This is a tabletop RPG, and it is assumed that the person reading these rules understands the basic concepts of a tabletop RPG.

			<br><br>It is a system that uses a Game Master. 

			<br><br>It is NOT a single-player RPG. 

			<br><br>These rules are designed to take you from character creation through a single session. 

			<br><br>The central idea is that you can play a spontaneous game with fast character creation and quick, tactical combat. 


			<br><br><h2 id="materialsH">What Do I Need To Play?</h2>
			One Smartphone per player
			Wireless Internet access (or cellular data)
			Dice: d20, d12, d10, d8, d6, d4 
			A combat grid, any scale
			Something to represent each PC and enemies (paper clips, miniatures, candy, etc.)

			<br><br><p>You do NOT need:</p>
			To sign up for anything
			To install any apps
			To give out any personal information
			To pay money


			<br><br><h2 id="gettingStartedH">How Do I Get Started? </h2>
			Read the rest of this document. Or just read the Quick Reference and then come back to this document as needed.

			<br><br><h2 id="settingH">The Setting</h2>
			The game takes place in a medieval fantasy world where everyone has magic inside of them. 

			<br><br>Some people use this magic for enhancing their natural abilities. Others use it to create unnatural or impossible feats of arcane trickery. 

			<br><br>The world is filled with strange and magical creatures, whose magic allows then to assume fantastical forms with powerful abilities.

			<br><br>Conflict is ever-present in the world. 

			<br><br>Maybe it is the political turmoil amidst the ruling class of a warring nation,

			<br><br>maybe it is the resurrection of the dread warrior-king Thalamos, 

			<br><br>maybe it is the new Royal Airship Highway to the lands of the eastern airship pirates, 

			<br><br>or maybe it the rise of the Death’s Hand cult under the insane wizard Merlin. 

			<br><br>Whatever the case, there is always a story and a role to play in the great forces that are shaping the world.

			<br><br>The setting is left vague to allow the GM to create the world of their imagination. Do not feel like you need to use this exact setting to play the game. While the player’s moves and abilities are named in a way that evokes high fantasy, the game can be re-skinned to fit many different settings.


			<br><br><h2 id="adventuringH">Adventuring</h2>
			At some point, your character will encounter a challenge in the world that he will have a chance of failing at. 

			<br><br>Whenever there is a dramatic situation, and a character’s success will change the course of events, and there is some chance of failure, the GM will have the player roll a check. 

			<br><br>A check consists of a player rolling a d20 and adding their appropriate skill or attribute to the number rolled.

			<br><br>For a skill check, approximate target numbers (TN) and difficulties  are listed below:


			<br><br>(A target number is the number that you must equal or surpass to earn a success)

			<br><br>Occasionally, you will test an ability instead of a skill. This works the same way.

			<br><br><h2 id="criticalH">Critical!</h2>
			When you roll a 20 on the d20, you keep the 20, pick up the d20 and roll again. Then you add the number that you rolled to the 20, and that is your roll total. If you roll a 20 again, you repeat this process until you roll something other than a 20.
			<h2 id="combatH">Combat</h2>
			Combat in Smartphones and Dragons is conducted in turns. 

			<br><br>Whoever initiates the combat goes first. By that I mean, whichever team (players or GM) says that they want to enter combat is the initiating team. 

			<br><br>If the initiator surprises her opponent, she goes first and starts with her max AP. 

			<br><br>However, if the opponent is expecting an attack, the initiator’s team only starts with half of their max AP.

			<br><br><h2  id="howToAttackH">How to Attack Stuff</h2>
			To attack something, you declare on your turn that you intend to use an ability on it.

			<br><br>In the app, you can press the “use” button of the ability, and it will tell you what you need to roll to succeed (if anything). 

			<br><br>For a basic melee attack, you need to roll your attack (whichever melee weapon you have), and compare the number you roll to your opponent’s defense. If you equal or surpass the defense, then you hit. 

			<br><br>If you are attacking and you successfully hit, then you apply the effect listed in the ability. Often times this will confer a status (see Statuses, below).

			<br><br>If that effect says to roll damage, the number that you roll is indicated by your weapon. 

			<br><br>Your weapon damage should be in red on your character page. 

			<br><br>If the number you roll on weapon damage is higher than your opponent’s Damage Threshold (DT), you confer the Hurt status on them. 

			<br><br>When you deal double a character's DT in damage, you skip past the Hurt Status and incapacitate them immediately.

			<br><br>Depending on the kind of attack, the Hurt status represents a different kind of injury, but in any case, it’s bad news for the receiver.

			<br><br>If a character already had the Hurt status when you rolled higher than their damage threshold, they become incapacitated.

			<br><br><h2 id="abilitiesH">Abilities</h2>
			All attacks are abilities, but not all abilities are attacks.

			<br><br>Whenever you use any ability, you must use the number of Action Points indicated on the ability’s card. AP cost is the number inside the circle. 

			<br><br>If you do not have enough action points, then you cannot use an ability.

			<br><br>Some abilities are special.

			<br><br>Passive abilities (they will have the passive keyword), are always active and require no AP.

			<br><br><h2 id="instantsH">Instants</h2>
			Instant abilities can be used on other player’s turns, but still cost AP. If you don’t have enough AP, you can’t use an instant.

			<br><br>If you use an instant in response to another instant, you create what is called the “stack”. The stack is a term from many games, and what it means is that the last instant is the first one to activate, followed in order back until the first. This does not come up often

			<br><br><h2 id="statusesH">Statuses</h2>
			Statuses are big part of combat in S&D. 

			<br><br>A status represents that a character has some condition, which could be good or bad.

			<br><br>For example, the Burning status indicates that the character is on fire. 


			<br><br><h2 id="statusEffectsH">Glossary of Status Effects </h2>

			<br><br>What does “Save Ends” mean?
			“Save Ends”, means that at the start of your turn you roll a d20. On a 10+, you save: the status is now gone.

			<br><br><h3>Marked:</h3>
			Someone has marked you as a target. This status has no other effect. Save Ends. 

			<br><br><h3>Incapacitated:</h3>
			You are either dead or unconscious. Either way, you can’t do anything.

			<br><br><h3>Prone: </h3>
			You cannot use the move ability. You take a -1 penalty to defense while Prone. You can remove the prone status on your turn for the cost of 2 move actions (if you have heavy armor this will cost more than 2 AP).

			<br><br><h3>Immobilized: </h3>
			You cannot use the move ability. Save Ends.

			<br><br><h3>Grappled: </h3>
			You cannot use any ability except a standard attack at -2 or break free (strength test against grappler) for 4 AP.

			<br><br><h3>Frozen / Paralyzed: </h3>
			You cannot take any action. Save Ends.

			<br><br><h3>Poisoned / Burning / Blighted: 	</h3>
			Your Damage Threshold is lowered by X (where x is specific to source of this status). Save Ends.

			<br><br><h3>Weakened: 	</h3>
			When rolling, roll twice and take the lower result. Save Ends.

			<br><br><h3>Frightened: </h3>	
			You cannot move towards the source. Save Ends.

			<br><br><h3>Slowed: </h3>
			Movement costs an additional AP. Save Ends.

			<br><br><h3>Exhausted: 	</h3>
			Receive half max AP (rounded up)
			
			<br><br><h3>Aura: </h3>
			Different Aura effects have different benefits, but you can only have one Aura type status at any time.

			<br><br><h2 id="combatExampleH">Combat Example: Slayer vs. Orc</h2>
			<span style="font-style: italic;">
			<br><br><h3>Turn 1 - Slayer</h3>

			<br><br>I (Slayer) attack the orc. We are pretty well matched.

			<br><br>I initiated the battle and so I go first.

			<br><br>Because this is the very first turn, I start with half of my maximum of 10 Action Points (AP). 

			<br><br>Ordinarily, all characters have a maximum of 10 AP, which they replenish at the END of their turn.

			<br><br>I look at the moves available to me as a Slayer, and decide that I want to do a Melee Attack. 

			<br><br>A Melee Attack costs four AP, which I have. 

			<br><br>Once I use it, it is pretty much all I can do, since I only have 5 AP this turn. 

			<br><br>When I use Melee Attack, I subtract the 4 AP that it costs, leaving me with 1 AP.

			<br><br>I roll a twenty sided die (d20) and add the melee skill I will be using (Two-Handed Weapons). I compare the result against the Orc’s Defense (16).

			<br><br>I roll a 7, plus my Two-Handed Weapons of 9 gives me 16, which just barely beats the orc’s defense of 16, so I successfully hit. 

			<br><br>To defeat the orc that I hit, I roll damage. To find out how much damage I do to the Orc, I look at my weapon’s damage. 

			<br><br>In this case, my weapon's description says that it deals 1d10 + Strength (my Strength is a 3)

			<br><br>Now I roll, but unfortunately, I roll a 1, leaving my damage at 4. This does not overcome the Orc's Damage Threshold of 9 so I am unsuccessful in hurting it.

			<br><br>The GM narrates how the Orc laughs at the weak, little cuts that my sword opens.

			<br><br>Since it is the end of my turn, I replenish my AP. 

			<br><br><h3>Turn 1 - Orc</h3>

			<br><br>Now it is the Orc's turn.

			<br><br>The Orc moves back and throws a boulder at me. To accomplish this, the GM rolls a d20 and adds the Orc's Throwing Weapons skill. 

			<br><br>To determine what number it needs to successfully hit, the GM looks on the appropriate range table. She discovers that to hit a normal target at short range with a cumbersome projectile will take a 15 or higher. She rolls a 17, so that hits.

			<br><br>She rolls for damage. The Boulder deals 1d4 + 2 * Strength damage. The orc has a Strength of 5, so even though she rolls a 1, that's still way over my Damage Threshold of 6. Ouch!

			<br><br>When my character is hit with an attack that deals greater than his Damage Threshold of damage, it means that he cannot withstand that amount of damage and keep on fighting.

			<br><br>To reflect this, a character who is damaged above their DT gains the Hurt status.

			<br><br>When a character is Hurt, they can defend, and use their basic move but they cannot do anything else. 

			<br><br>The only way to keep fighting is through sheer willpower, or Spirit.

			<br><br>In order to remove the Hurt status, I have to roll Spirit at the start of my turn:
			- If I get less than a 10, I remain Hurt and cannot try to remove the status again until the start of my next turn. 
			- If I got less than a 20, I can remove the status by spending 20 minus my roll's worth of AP. For example, if I rolled an 11, I would have to spend 9 AP to remove the status. 
			- If I roll 20 or over, I can remove the status and then take my turn normally.

			<br><br>Being hurt is very bad because it leaves you vulnerable: If an attack overcomes your DT while you have the Hurt status, instead of getting the Hurt status again, you are incapacitated / out of the fight for good!

			<br><br><h3>Turn 2 - Slayer</h3>

			<br><br>I roll Spirit and I get a 19 total. I spend the 1 AP to remove the Hurt status and then I use Leaping Chop, which doubles my damage on a successful hit.

			<br><br>Let's say that I successfully hit.

			<br><br>Whatever the resulting damage is, I double it because of Leaping Chop.

			<br><br>This time, when I roll for damage (using the same weapon) I roll a 9, for a total of 24 damage! ( (9+3)*2 ) 

			<br><br>That is more than enough to overcome the Orc's DT. 

			<br><br>Not only does it overcome the Orc's DT, but it deals more than 2 times the Orc's DT, which means that I incapacitate the Orc with one hit. (When you deal double a character's DT, you skip past the Hurt Status and incapacitate them directly)

			<br><br>The GM gives me permission to describe the killing blow, so I tell the group, "The Slayer arcs his trained blade down through the Orc's chest, and the Orc falls with a mighty thud upon the cracked earth."
			</span>
			</div>
			<div class="quickstart">
				<h5 id="quickReference">Quick Reference</h5>
				<h4>Acting</h4>
				Declare Intention and Action, roll skill check if necessary.
				</h4>Action Points</h4>
				AP or Action Points are used to take actions in combat. 
				You have a maximum of 10
				AP replenishes at the end of your turn.
				<h4>Starting Combat</h4>
				Say: “I attack!”, then you go first. 
				You get 5AP your first turn. Your opponents get 10AP their first turn because they go second.
				<h4>Abilities</h4>
				Push the “Use” button on the ability card. 
				The popup will tell you what dice to roll (or just use the simulator).
				Subtract AP cost from your AP (located in the circle on the ability card)
				<h4>Damaging Abilities</h4>
				If your effect is damage, roll that damage against your target’s damage threshold
				If you equal or beat it, then the target receives the Hurt status
				If the target already had the Hurt status, then they are incapacitated
				If you beat the target’s damage threshold by double, then they are incapacitated immediately
				<h4>Instant Abilities</h4>
				Abilities marked with the word instant can be used on other players turns. (after where it normally says “On Success”) 
				Instant Abilities sometimes have a “Trigger”, which means that something has to happen to use the ability.
			</div>
    	</div>
		<div class="moveBox">
			<div class="topRow"><p class="moveName">An Error Has Occured</p></div>
			<div class="circle"><span class="AP">3</span></div><span class=buttonHolder><button class="addBtn">Add to <b>My Moves</b></button></span>
			<br>
			<!-- Roll -->
			<div class="categoryLabel">
				<div>Roll</div>
				<div class="decorativeLine"></div>
			</div>
			<div>Contact creator for tech support bxc3201@rit.edu</div>
			<!-- Effect -->
			<div class="categoryLabel">
				<div>Effect</div>
				<div class="decorativeLine"></div>
			</div>
			<div>If you are seeing this message, the program is broken.</div>
			<!-- Roll -->
			<div class="categoryLabel">
				<div>Range and Area</div>
				<div class="decorativeLine"></div>
			</div>
			<div>Try reloading the page. If that does not fix the problem, try using a different browser.</div>
		</div>
		<div class="helpfulHint">
			Confused? View the <span class="link" id="quickReferenceLink">Quick Reference</span>, or <span class="link" id="combatExampleLink">Combat Example</span>.
		</div>
		<div class="definitionBox">
			<div class="defNavBar">
				<div class="defNavBtn" id="defBack"> < </div>
				<div class="defNavBtn" id="defFwd"> > </div>
				<div class="closeBottomBarButton" id="closeDefBox"></div>
				<div class="definitionHeader">Initiative</div>
			</div>
			<div class="defBody">
				<p>Initiative is the fancy name for which team goes first in combat. A team gains initiative by taking the initiative! Heh. That’s just a silly way of saying that if you want to go first in a combat, declare that you attack, and you will go first.</p>
			</div>
			
			</div>
		</div>
		<p id="mobileDebug">Debug</p>
	</body>  
	<!--script that holds the json-->
	<script src="jsonString.js"></script>
    <!--script that deals with the move panel behaviours-->
	<script>
	// Move class
    function Move(name, roll, AP, effect, range, special, trigger, difficulty) {
    	this.name = name;
    	this.roll = roll;
    	this.AP = AP;
    	this.effect = effect;
    	this.range = range;
    	this.special = special;
    	this.added = false;
    	if (!trigger) {
    		trigger = "";
    	}
    	this.trigger = trigger;
    	this.difficulty = difficulty;
    }
    
    // GLOBAL VARS
    var dbg = getById("mobileDebug");
    var allMoves = [];
    var myMoves = [];
    var basicMoves = [];
	var slayerMoves = [];
	var defenderMoves = [];
	var scholarMoves = [];
	var battlemageMoves = [];
	var assasinMoves = [];
	var hunterMoves = [];
	var currScreen = "Main Menu";
	var prevScreen = "";
	var backDisabled = true;
	var glossary = JSON.parse(glossaryString).glossary;
	var keywords = {};
	var glossaryHistory = [];
	var glossaryForward = [];
	var collapserObjects = {};
	
	var choiceDescriptions = {
		"Slayer" : "<br><img src='images/Slayer.png' class='classPic'/><br>The Slayer is a monster specialist. Tough and damage-focused.",
		"Defender" : "<br><img src='images/Defender.png' class='classPic'/><br>The Defender is a professional soldier. Battle hardened and team-focused.",
		"Battlemage" : "<br><img src='images/Battlemage.png' class='classPic'/><br>The Battlemage is an expert on combat-magic. Powerful and control-focused.",
		"Scholar" : "<br><img src='images/Scholar.png' class='classPic'/><br>The Scholar is a learned arcane master. Intelligent and tactics-focused.",
		"Assassin" : "<br><img src='images/Assassin.png' class='classPic'/><br>The Assassin is a contract killer. Ruthless and target-focused.",
		"Hunter" : "<br><img src='images/Hunter.png' class='classPic'/><br>The Hunter is a master of thriving in nature. Keen and trap-focused.",
		"Smithing and Appraisal" : "Smithing allows you to craft weapons, armor, and other objects out of metal, given a proper forge.  Appraisal allows you to judge the proper value for an item, particularly weapons, armor, jewelry, and other treasure.",
		"Acrobatics and Athletics" : "Acrobatics allows you to perform daunting acts with your body, like walking on a thin ledge or performing a flip. Athletics allows you to perform feats of strength such as running long distances and carrying heavy objects.",
		"Performance and Bluff" : "Performance allows you to play instruments, give a persuasive argument, or give a rousing speech. Bluff allows you to tell convincing lies, or convincingly fake an identity",
		"Alchemy and Cooking" : "Alchemy allows you craft useful potions. Cooking allows you to cook delicious meals and prepare rare or dangerous dishes.",
		"Thievery and Sneaking" : "Thievery allows you to successfully steal things without getting notice. Sneaking allows you to hide in difficult places and to move without making noise. Some characters get advantages for being hidden in combat.",
		"Survival and Tracking" : "Survival allows you to make shelters, locate water, and other skills you would need to survive outside of civilization. Tracking allows you to find animals in their habitats, or to follow a person or creature using only their tracks."
	}
    var character = {}; // character object, stores attributes and skills
    character.name = "Anonymous";
    character.attributes = { "Strength" : 0, "Agility" : 0, "Intelligence" : 0, "Spirit" : 0 };
    character.fightingStyles = {}; // these are filled out later
    character.skills = {}; // these are filled out later
    character.moves = [];
    character.meta = {"complete": false, "lastModified" : "never"};
    var cookieList = [];
    var HP = 10;
    var AP = 10;
    var maxAP = 10;
    var classInagl=0;
    var choiceText = [
		"Create a Character",
		"Choose your <span class='keyword' onclick='d(\"Archetype\")'>archetype</span>",
		"Choose your skills",
		"Choose exactly four (4) abilities",
		"Choose a name"
	];
	character.charClass = "none";
	var primaryFightingStyleChoice;
	character.primaryFightingStyle = "none";
	var secondaryFightingStyleChoice;
	character.secondaryFightingStyle = "none";
	var primarySkillChoice;
	character.primarySkill = "none";
	var secondarySkillChoice;
	character.secondarySkillChoice = "none";
    var fightingStyles = [
	"Martial Combat",
	"One Handed Weapons",
	"Two Handed Weapons",
	"Throwing Weapons",
	"Marksmanship",
	"Magic"
	];
	var skills = [
	"Smithing and Appraisal",
	"Acrobatics and Athletics",
	"Performance and Bluff",
	"Alchemy and Cooking",
	"Thievery and Sneaking",
	"Survival and Tracking"
	];
	var characterClasses = [
	"Slayer", 
	"Defender",	
	"Scholar", 
	"Battlemage", 
	"Assassin", 
	"Hunter"
	];
	/*var phyOrMen = choiceBtnGroup(["physicalBtn","mentalBtn"]);
    var strOrAgl = choiceBtnGroup(["agilityBtn","strengthBtn"]);
    var intOrSpi = choiceBtnGroup(["intelligenceBtn","spiritBtn"]);*/
	var primarySkillChoice = {};
	var choiceNumber = 1;
	var lastChoice = 4;
	var bottomTimeout;
	var choiceTextElem = getById("choiceDescriptionText");
	var defBox = getByClass("definitionBox");
	
	var weaponDefaults = {
		"Martial Combat" : "Fists",
		"One Handed Weapons" : "Shortsword",
		"Two Handed Weapons" : "Battleaxe",
		"Throwing Weapons" : "Throwing-Knives",
		"Marksmanship" : "Longbow",
		"Magic" : "Staff"
	};
	/*var weapon1Defaults = {
		"Slayer" : "Battleaxe",
		"Defender" : "Longsword",
		"Scholar" : "Staff",
		"Battlemage" : "Staff",
		"Assassin" : "Shortsword",
		"Hunter": "Longbow"
	}
	var weapon2Defaults = {
		"Slayer" : "Longbow",
		"Defender" : "Throwing-Spears",
		"Scholar" : "Throwing-Knives",
		"Battlemage" : "Throwing-Knives",
		"Assassin" : "Throwing-Knives",
		"Hunter": "Shortsword"
	}
	var attributeDefaults = {
		"Slayer" : [5,4,4,3],
		"Defender" : [4,5,3,4],
		"Scholar" : [4,4,5,3],
		"Battlemage" : [3,4,5,4],
		"Assassin" : [4,5,4,3],
		"Hunter": [4,5,4,3]
	}*/
	var archetypes = {
		"Slayer" : 
		{
			"Weapon1" : "Battleaxe",
			"Weapon2" : "Longbow",
			"Attributes" : [6,4,4,2],
			"Attack" : 5,
			"Defense" : 3,
			"HP" : 15
		},
		"Defender" : 
		{
			"Weapon1" : "Longsword",
			"Weapon2" : "Buckler-Shield",
			"Attributes" : [5,5,2,4],
			"Attack" : 4,
			"Defense" : 4,
			"HP" : 16
		},
		"Scholar" : 
		{
			"Weapon1" : "Staff",
			"Weapon2" : "Throwing-Knives",
			"Attributes" : [2,4,7,6],
			"Attack" : 3,
			"Defense" : 2,
			"HP" : 12
		},
		"Battlemage" : 
		{
			"Weapon1" : "Staff",
			"Weapon2" : "Throwing-Knives",
			"Attributes" : [2,4,6,4],
			"Attack" : 3,
			"Defense" : 2,
			"HP" : 13
		},
		"Assassin" : 
		{
			"Weapon1" : "Shortsword",
			"Weapon2" : "Throwing-Knives",
			"Attributes" : [4,6,4,2],
			"Attack" : 6,
			"Defense" : 2,
			"HP" : 14
		},
		"Hunter": 
		{
			"Weapon1" : "Longbow",
			"Weapon2" : "Shortsword",
			"Attributes" : [4,6,4,2],
			"Attack" : 5,
			"Defense" : 2,
			"HP" : 13
		}
	}
	
	function Weapon(nameArg, damageArg, APArg, bonusArg, typeArg, specialArg) {
		this.name = nameArg;
		this.AP = APArg;
		this.bonus = bonusArg;
		this.damage = damageArg;
		this.type = typeArg;
		this.special = specialArg;
		this.print = function() {
			return this.name + ": " + this.damage + " " + this.type + " damage, " + this.AP + " AP drain, " + this.bonus + " bonus attack, special:" + this.special;
		}; 
	}
	
	var weapons = [];
	weapons.push(new Weapon("Fists","d4 + Strength","-1",0,"melee",""));
	weapons.push(new Weapon("Shortsword","d6 + Strength","+0",1,"melee",""));
	weapons.push(new Weapon("Battleaxe","d12 + Strength","+1",0,"melee",""));
	weapons.push(new Weapon("Throwing-Knives","d4 + Strength","+0",0,"ranged",""));
	weapons.push(new Weapon("Longbow","d6 + Strength","+0",0,"ranged",""));
	weapons.push(new Weapon("Crossbow","6","+0",0,"ranged",""));
	weapons.push(new Weapon("Staff","d4 + Strength","+0",0,"melee","Magic +1"));
	weapons.push(new Weapon("Longsword","d8 + Strength","+0",0,"melee",""));
	weapons.push(new Weapon("Throwing-Spears","d6 + Strength","+0",0,"ranged",""));
	weapons.push(new Weapon("Buckler-Shield","0","+0",0,"melee",""));
	
    var moveLists = { 
	"moves" : allMoves, 
	"myMoves" : myMoves,
	"basic" : basicMoves, 
	"Slayer" : slayerMoves, 
	"Defender" : defenderMoves, 
	"Scholar" : scholarMoves, 
	"Battlemage" : battlemageMoves, 
	"Assassin" : assasinMoves, 
	"Hunter" : hunterMoves 
	}
	
	// Basic moves
	basicMoves.push(new Move(
		"Move",
		"",
		1,
		"Move one space",
		"",
		""
		)
	);
    basicMoves.push(new Move(
    	"Basic Melee Attack",
    	"Agility",
    	4,
    	"Inflict Melee Weapon Damage.",
    	"Touch",
    	""
    	)
    );
    basicMoves.push(new Move(
    	"Basic Ranged Attack",
    	"Agility",
    	5,
    	"Inflict Ranged Weapon damage",
    	"Long",
    	"",
    	"",
    	"Short-range: 12 + target Defense, Medium-range: 16 + target Defense, Long-range: 20 + target Defense."
    	)
    );
    basicMoves.push(new Move(
    	"Full Melee Attack",
    	"Agility",
    	6,
    	"Inflict Melee Weapon + 4 Damage",
    	"Touch",
    	""
    	)
    );
    basicMoves.push(new Move(
    	"Trip",
    	"Agility",
    	5,
    	"Target makes an Agility roll with a Difficulty equal to the value of your roll, or gains the Prone status",
    	"Touch",
    	""
    	)
    );
    basicMoves.push(new Move(
    	"Full Defense",
    	"",
    	6,
    	"Defense +4 until the start of your next turn",
    	"",
    	""
    	)
    );
    basicMoves.push(new Move(
    	"Mark",
    	"",
    	2,
    	"Target gains the Marked status",
    	"Sight",
    	""
    	)
    );
    basicMoves.push(new Move(
    	"Defend",
    	"d20 + Defense",
    	2,
    	"Attacker's ability roll must exceed your roll in order to apply its effect.",
    	"",
    	"Reaction",
    	"You are attacked at touch range"
    	)
    );
    basicMoves.push(new Move(
    	"Quick Defend",
    	"d20 + Defense - 2",
    	1,
    	"Attacker must make an Attack Roll exceeding your roll",
    	"",
    	"Reaction",
    	"You are attacked at touch range"
    	)
    );
    basicMoves.push(new Move(
    	"Improved Defend",
    	"d20 + Defense + 2",
    	3,
    	"Attacker must make an Attack Roll exceeding your roll",
    	"",
    	"Reaction",
    	"You are attacked at touch range"
    	)
    );
    basicMoves.push(new Move(
    	"Great Defend",
    	"d20 + Defense + 4",
    	4,
    	"Attacker must make an Attack Roll exceeding your roll",
    	"",
    	"Reaction",
    	"You are attacked"
    	)
    );
    basicMoves.push(new Move(
    	"Dodge",
    	"d20 + Defense + Agility",
    	5,
    	"Attacker must make an Attack Roll exceeding your roll",
    	"",
    	"Reaction",
    	"You are attacked"
    	)
    );
    
    // Mark basic moves
    basicMoves.forEach(function(m) {
    	m.basic = true;
    	myMoves.push(m);
    	allMoves.push(m);
    });
    
    function getWeapon(name) {
    	for (var i=0; i<weapons.length; i++) {
    		if (weapons[i].name == name) {
    			return weapons[i];
    		}
    	}
    	// if none
    	return weapons[0];
    }
    
    function createUseButton(moveObject) {
		var useBtn = document.createElement("button");
		useBtn.setAttribute("class","useBtn");
		useBtn.innerHTML = "use (" + moveObject.AP + " AP)";
		useBtn.onclick = function() {
			useAbility(moveObject);
		}
		return useBtn;
    }
    
    function removeUseButtons(containerElem) {
    	var UseButtons = containerElem.querySelectorAll(".useBtn");
		for (var j=0; j<UseButtons.length; j++) {
			UseButtons[j].parentNode.removeChild(UseButtons[j]);
		}
    }
    
    var addText = 'Add to <span style="font-weight: bold">My Moves</span>';
    var removeText = 'Added';
    var useText = 'Use';
    var buttonText = addText;
    
    function displayMove(move) {
    	displayMove(move,true,document.body);
    }
    
    function displayMove(move, hideButton) {
    	displayMove(move, hideButton, document.body);
    }
    
    var abilityBoxUniqueId = 0;
    function displayMove(move, hideButton, containerElem) {
    	if (containerElem == null) { containerElem = document.body; }
    	var rollStr = "";
    	if (move.roll != "") {
			rollStr = '<div class="categoryLabel">Roll</div>'+
			'<div>'+move.roll+'</div>';
		}
		var diffStr = "";
		if (move.difficulty != null && move.difficulty != "") {
			diffStr = '<div class="categoryLabel">Difficulty</div>'+move.difficulty;
		}
    	
    	var rangeStr = "";
    	if (move.range != "") {
			rangeStr = '<div class="categoryLabel">Range</div>'+
			'<div>'+move.range+' </div>'
		}
		
		if (move.AP == "") {
			move.AP = "0";
		}
		var special = "Effect"; // default
		if (move.roll != "" && move.roll != null) {
			special = "On Success" // if a roll is required
		}
		if (move.special != null && move.special != "") {
			special = ' ['+move.special+']';
		}
		
		var triggerStr = "";
		if (move.trigger != "" && move.trigger != null) {
			triggerStr = '<div class="categoryLabel">Trigger</div><div>' + move.trigger + '</div>';
		} 
		
    	// create the box that displays the move
		var outerContainer = document.createElement("div");
		outerContainer.setAttribute("class","moveBox");
		// increase unique Id for collapsing
		abilityBoxUniqueId++;
		// create outer shell and name
		outerContainer.innerHTML = '<div class="topRow" id="AB'+abilityBoxUniqueId+'"><p class="moveName">'+move.name+'</p></div>';
		// create inner part and contents
		var container = document.createElement("div");
		container.setAttribute("class","innerMoveBox");
		container.innerHTML = 
		/*'<div class="circle keyword" style="text-decoration: none" onclick="d(\'AP\')">'+
		'<span class="AP">'+
		move.AP+'</span></div><span class=buttonHolder></span><br>'+
		*/
		// Roll
		parseKeywords(rollStr) + diffStr +
		// Reaction Trigger
		parseKeywords(triggerStr) +
		// Effect
		'<div class="categoryLabel">'+special+'</div>'+
		'<div>'+parseKeywords(move.effect)+'</div>'+
		// Range
		parseKeywords(rangeStr);

		// display the box on the page
		if (myMoves.indexOf(move) > -1) {
			//	add use button	
			var useBtn = createUseButton(move);
			useBtn.setAttribute("class","useBtn");
			removeUseButtons(container);
			outerContainer.appendChild(useBtn);
		}
		outerContainer.appendChild(container);
		containerElem.appendChild(outerContainer);
		
		if (!move.basic && hideButton == false) {
			// add the "add to moves" button
			var addBtn = document.createElement("button");
			addBtn.setAttribute("class","addBtn");
			addBtn.innerHTML = buttonText;
			addBtn.onclick = function() {
				if (move.added) {
					console.log(move.name + " removed");
					myMoves.pop(move);
					character.moves.pop(move.name);
					move.added = false;
				
					addBtn.innerHTML = addText;
					addBtn.style.backgroundColor = "rgba(255,255,255,0.5)";
				
					removeUseButtons(container);
				}
				else {
					console.log(move.name + " added");
					myMoves.push(move);
					console.log(myMoves);
					character.moves.push(move.name);
					move.added = true;
				
					addBtn.innerHTML = removeText;
					addBtn.style.backgroundColor = "rgba(0,255,0,0.5)";
				
					var useBtn = createUseButton(move);
					removeUseButtons(container);
					container.querySelector(".buttonHolder").appendChild(useBtn);
				}
			}
			container.querySelector(".buttonHolder").appendChild(addBtn);
			if (myMoves.indexOf(move) > -1) {
				addBtn.style.backgroundColor = "rgba(0,255,0,0.5)";
				addBtn.innerHTML = removeText;
			}
		}
		
		 collapserObjects["AB"+abilityBoxUniqueId] = new Collapser(outerContainer,outerContainer.querySelector(".topRow"),container);
    }
    
    function useAbility(moveObject) {
    	//console.log(moveObject.roll);
    	// subtract AP
    	addToAP(-1 * moveObject.AP)
    	
    	// move up info box
    	extendUseBox();
    	
    	var roll = tryParseRoll(moveObject.roll);
    	if (roll != null && roll != "") {
    		roll = "<br>Roll: " + roll;
    	} else {
    		roll = "";
    	}
    	
    	// set menu text to AP
    	getById("rollCalculation").innerHTML = moveObject.name + " used."
    	+ "<br>AP used: " + moveObject.AP + "  Current AP: " + AP;
    	//+ roll;
    	
    	/*if (moveObject.roll == "") {
    		getById("rollCalculation").innerHTML = "This ability automatically succeeds";
    	}
    	else {
    		var result = tryParseRoll(moveObject.roll) 
    		console.log(result);
    		if (result == "" || result == undefined) {
    			getById("rollCalculation").innerHTML = moveObject.roll;
    		}
    		else {
    			getById("rollCalculation").innerHTML = result;
    		}
    	}*/
    	
    	// offer "simulate roll" button
    }
    
    function tryParseRoll(rollStr) {
    	var newStr = "";
    	var rollStrArr = rollStr.split(" ");
    	for (var i=0; i<rollStrArr.length; i++) {6
    		var word = rollStrArr[i];
    		var found = false;
    		switch (word) {
				case "Attack":
					found = true;
					newStr += "d20 + "+character.attributes["Agility"];
					break;
				case "Defense":
					found = true; 
					newStr += "d20 + "+archetypes[character.charClass].Defense;
					break;
			}
			var skills_ = Object.keys(character.skills);
			for (var j=0; j<skills_.length; j++) {
				if (found) { break; }
				var skill = skills_[j];
				if (word == skill) {
					found = true;
					newStr += "1d20 + "+ word +"[" + character.skills[skill] + "]";
					break;
				}
				else if (word == skill.split(" and ")[0]) {
					found = true;
					newStr += "d20 + "+ word +"[" + character.skills[skill] + "]";
					break;
				}
				//console.log(skill.split(" and ")[1]);
				else if (word == skill.split(" and ")[1]) {
					found = true;
					newStr += "d20 + "+ word +"[" + character.skills[skill] + "]";
					break;
				}
			}
			var keys_ = Object.keys(character.attributes);
			for (var j=0; j<keys_.length; j++) {
				if (found) { break; }
				var k = keys_[j];
				if (word == k) {
					found = true;
					newStr += "d20 + " + character.attributes[k];
					break;
				}
			}
			
    		/*var styles_ = Object.keys(character.fightingStyles);
    		for (var j=0; j<styles_.length; j++) {
    			var style = styles_[j];
    			if (word == style) {
    				return "1d20 + "+ word +"[" + character.fightingStyles[word] + "]";
    			}
    		}*/
    		if (!found) {
    			newStr += word;
    		}
    	}
    	return newStr;
    }
    
    function listMoves(moveListName) {
    	//console.log("listMoves " + moveListName + " " + moveLists[moveListName].length);
		for (var i=0; i<moveLists[moveListName].length; i++) {
			displayMove(moveLists[moveListName][i]);
		}  
		//activateKeywords(); console.log("burp"); 
	}
	
	function listMovesCC(moveListName) {
		for (var i=0; i<moveLists[moveListName].length; i++) {
			displayMove(moveLists[moveListName][i],false);
		} 
	}
	
	function listMyMoves() {
		console.log("listMoves " + myMoves + " " + myMoves.length);
		for (var i=0; i<myMoves.length; i++) {
			displayMove(myMoves[i]);
		} 
	}
	
	function clearMoves() {
		var boxes = document.querySelectorAll(".moveBox");
		for (var i=0; i<boxes.length; i++) {
			boxes[i].parentNode.removeChild(boxes[i]);
		}

	}
	
	function clearScreens() {
		clearMoves();
		getById("loadButtons").style.display = "none";
		getById("mainMenu").style.display = "none";
		getById("saveArea").style.display = "none";
		getByClass("myCharacterBox").style.display = "none";
		getByClass("helpBox").style.display = "none";
		getById("aboutSection").style.display = "none";
		getByClass("helpfulHint").style.display = "none";
	}
	
    function getByClass(className) {
    	return document.querySelector("."+className);
    }
    function getById(id) {
    	return document.getElementById(id);
    }
	
    function resetAP() {
    	setAP(maxAP);
    }
    function setAP(value) {
    	AP = value;
    	getByClass("APCounter").innerHTML = "" + AP + "AP";
    	getByClass("BBAPCounter").innerHTML = "" + AP + " AP";
    }
    function addToAP(arg) {
    	setAP(AP + arg);
    }
    function extendMenu() {
    	getByClass("topBar").style.top = "-28em";
    	getByClass("optionsBtn").style.display = "none";
    	getByClass("hideBtn").style.display = "block";
    }
    function retractMenu() {
    	getByClass("topBar").style.top = "-51em";
    	/*getByClass("hideBtn").style.display = "none";
    	getByClass("optionsBtn").style.display = "block";*/
    }
    function extendUseBox() {
    	getByClass("bottomBar").style.bottom = "-4em";
		clearTimeout(bottomTimeout);    	
    	bottomTimeout = setTimeout(function() {
    		retractUseBox();
    	},9000);
    }
    function retractUseBox() {
    	getByClass("bottomBar").style.bottom = "-11em";
    }

    function hasClass(ele,cls) {
	  return !!ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
	}
	function addClass(ele,cls) {
	  if (!hasClass(ele,cls)) ele.className += " "+cls;
	}
	function removeClass(ele,cls) {
	  if (hasClass(ele,cls)) {
		var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
		ele.className=ele.className.replace(reg,' ');
	  }
	}

    function choiceBtnGroup(buttonIdList, questionNum) {
    	var groupObject = {};
    	groupObject.selected = "none";
    	buttonIdList.forEach(function(buttonName) {
    		var cbtn = getById(buttonName);
    		cbtn.onclick = function() {
    			buttonIdList.forEach(function(buttonName) {
    				var btn = getById(buttonName);
    				removeClass(btn,"highlight");
    			});
				addClass(cbtn,"highlight");
				getById("done").setAttribute("class","complete");
				getById("done").removeAttribute("disabled");
				groupObject.selected = buttonName;
				if (choiceDescriptions[buttonName] != "" && choiceDescriptions[buttonName] != null) {
					choiceTextElem.innerHTML = choiceDescriptions[buttonName];
					choiceTextElem.style.display = "block";
				} 
				else {
					choiceTextElem.innerHTML = "";
					choiceTextElem.style.display = "none";
				}
    		}
    	});
    	return groupObject;
    }
	
	// The following 3 function run in order
	// 1) save answer from last question
	function addToCharacter() {
		switch (choiceNumber) {
		case 1:
			//primarySkillChoice.selected = skills[characterClasses.indexOf(characterClass.selected)];
			//character.primarySkill = primarySkillChoice.selected;
			
			// update character obj 
			character.charClass = characterClass.selected;
			
			// set attributes based on class
			character.attributes["Strength"] =  archetypes[character.charClass].Attributes[0]; // attributeDefaults[character.charClass][0];
			character.attributes["Agility"] = archetypes[character.charClass].Attributes[1];
			character.attributes["Intelligence"] = archetypes[character.charClass].Attributes[2];
			character.attributes["Spirit"] = archetypes[character.charClass].Attributes[3];
			
			// set primary and secondary weapon based on class
			character.primaryWeaponName = archetypes[character.charClass].Weapon1;
			character.secondaryWeaponName = archetypes[character.charClass].Weapon2;
			
			break;
		case 2:
			break;
		case 3:
			document.body.removeEventListener("click", checkSufficientMoves);
			break;
		case 4:
			character.name = getById("nameField").value;
			completeCharacter();
			console.log("done");
			break;
		default:
			break;
		}
	}
	
	// 2) advance to the next question
    function advanceQuestion() {
    	choiceNumber++;
		// present choices
		presentChoice(choiceNumber);
    }
    
    // 3) present the new question
    function presentChoice(choiceN) {
		// clear text
		choiceTextElem.innerHTML = "";
		choiceTextElem.style.display = "none";
		
		// 1 - Class
		if (choiceN == 1) {
			characterClass = createAndDisplayButtonGroup(characterClasses, getById("q1"));
			promoteToClassChoiceGroup(characterClasses, getById("q1"));
		}
		
		// 2 - Skills
		if (choiceN == 2) {
		/*
		//set primarySkillChoice.selected = result from class selection
		primarySkillChoice.selected = skills[characterClasses.indexOf(characterClass.selected)];
		//set correcponder character attribute
		character.PrimarySkill = primarySkillChoice.selected;
			var excludingPrimary = [];
			skills.forEach(function(skill) {
				if (skill != character.primarySkill) {
					excludingPrimary.push(skill)
				}
			});
			secondarySkillChoice = createAndDisplayButtonGroup(excludingPrimary, getById("q2"));
			
		*/
		}
		
		// 3 Moves
		if (choiceN == 3) {
			// Reset to basic moves
			myMoves = [];
			console.log("moves RESET");
			basicMoves.forEach(function(m) {
				m.basic = true;
				myMoves.push(m);
			});
			document.body.addEventListener("click", checkSufficientMoves);
			listMovesCC(character.charClass);
			window.scroll(0,0);
		}
		
		// All choices
			
		// clear previous choice from screen
		if (getById("q"+ (choiceN-1) )) {
			getById("q"+ (choiceN-1) ).style.display = "none";
		}
		// display current choice
		getById("q"+choiceN).style.display = "block";
		// set appropriate title
		getByClass("ccTitle").innerHTML = choiceText[choiceN];
	
		// reset next button until choice is made
		getById("done").setAttribute("class","incomplete");
		getById("done").setAttribute("disabled", "true");
		
		// Name
		if (choiceN == 4) {
			clearMoves();
			getById("done").setAttribute("class","complete");
			getById("done").removeAttribute("disabled");
		}
		if (choiceN == 2) {
			//getById("done").setAttribute("class","complete");
			//getById("done").removeAttribute("disabled");
			advanceQuestion();
		}
	}
    
    function createAndDisplayButtonGroup(listIds, container) {
			// clear container element
			container.innerHTML = "";
			// loop through choices and append the buttons
			listIds.forEach(function(id) {
				var choiceBtn = document.createElement("button");
				choiceBtn.setAttribute("id",id);
				choiceBtn.setAttribute("class","choice");
				choiceBtn.innerHTML = id;
				container.appendChild(choiceBtn);
			});	
			// add the buttons to a button group
			return choiceBtnGroup(listIds); // return the group object
    }
    
	function promoteToClassChoiceGroup(listIds, container) {
		listIds.forEach(function(id) {
			var classButton = getById(id);
			addClass(classButton,"classButton");
			/*
			var classPanel = document.createElement("div");
			classPanel.setAttribute("id",id + " panel");
			classPanel.setAttribute("class","classPanel");
			var classImg = document.createElement("img");
			classImg.setAttribute("id",id + " image");
			classImg.setAttribute("class","classImg");
			classImg.setAttribute("src","images/" + id + ".png");
			
			classPanel.appendChild(classButton);
			classButton.appendChild(classImg);
			container.appendChild(classPanel);*/
		});
	}
	
    function deleteDuplicateButtons() {
    	if (choiceNumber > 1 && choiceNumber < 4) {
			// special case for deleting buttons with the same id
			getById("q"+ (choiceNumber) ).innerHTML = "";
		}
    }
    
    function closeCreator() {
    	getByClass("characterCreationBox").style.display = "none";
    }
	
	function setMyCharacterBox() {
		getByClass("characterName").innerHTML = character.name;
		getByClass("characterClass").innerHTML = character.charClass;
		getByClass("str").innerHTML = character.attributes["Strength"];
		getByClass("agl").innerHTML = character.attributes["Agility"];
		getByClass("int").innerHTML = character.attributes["Intelligence"];
		getByClass("spi").innerHTML = character.attributes["Spirit"];
		getById("primaryWeaponImg").setAttribute("src","images/"+character.primaryWeaponName+".png");
		getById("primaryWeaponName").innerHTML = character.primaryWeaponName;
		getById("primaryWeaponDamage").innerHTML = convertDamageStr(getWeapon(character.primaryWeaponName).damage,1); 
		getById("secondaryWeaponImg").setAttribute("src","images/"+character.secondaryWeaponName+".png");
		getById("secondaryWeaponName").innerHTML = character.secondaryWeaponName;
		getById("secondaryWeaponDamage").innerHTML = convertDamageStr(getWeapon(character.secondaryWeaponName).damage,2);
		getById("defenseStat").innerHTML = archetypes[character.charClass].Defense;
		getById("damageThresholdStat").innerHTML = archetypes[character.charClass].HP;
		getById("characterPicture").setAttribute("src","images/"+character.charClass+".png")
		getByClass("SA").innerHTML = character.skills[skills[0]];
		getByClass("AA").innerHTML = character.skills[skills[1]];
		getByClass("PB").innerHTML = character.skills[skills[2]];
		getByClass("AC").innerHTML = character.skills[skills[3]];
		getByClass("TS").innerHTML = character.skills[skills[4]];
		getByClass("ST").innerHTML = character.skills[skills[5]];
	}
	
	function convertDamageStr(damStr, weaponNum) {
		// look for "dX"
		var dieType = "";
		for (var i=4; i<22; i+=2) {
			if (damStr.indexOf("d"+i) > -1) {
				dieType = "d"+i;
				break;
			}
		}
		if (dieType == "") {
			// hide image
			getById("weapon"+weaponNum+"Die").style.display = "none"
		} else {
			// change image
			getById("weapon"+weaponNum+"Die").setAttribute("src","images/"+dieType+".png" );
		}
		
		// look for Strength
		if (damStr.indexOf("Strength") > -1) {
			// replace with value
			return "+"+character.attributes["Strength"];
		}
		return damStr;
	}
	
	function completeCharacter() {
		setMyCharacterBox();
		var d = new Date();
		console.log(d.toISOString());
		//document.cookie = 'time=' + d.toISOString() + '; expires=Thu, 18 Dec 2020 12:00:00 UTC';
		character.meta.lastModified = d.toISOString();
		document.cookie = 'character=' + JSON.stringify(character) + '; expires=Thu, 18 Dec 2020 12:00:00 UTC'; 
		var saveMoveNames = [];
		console.log("character save complete");
		character.meta.complete = true;
		removeClass(getById("saveBtn"), "incomplete");
		addClass(getById("saveBtn"), "complete");
	}
	
	function checkSufficientMoves() {
		if (choiceNumber > 2) {
			console.log(myMoves.length);
			if (myMoves.length == 4 + basicMoves.length) {
				console.log("complete");
				window.scroll(0,0);
				addClass(getById("done"),"complete");
				getById("done").removeAttribute("disabled");
			}
			else {
				removeClass(getById("done"),"complete");
				getById("done").setAttribute("disabled",true);
			}
		}
	}
	
	function showCharacter() {
		dbg.innerHTML = "showCharacter started";
		if (!character.meta.complete) {
			//console.log(character.attributes);
			//console.log(character.meta.complete);
			console.log("incomplete character data");
			return;
		}
		getByClass("myCharacterBox").style.display = "block";
	}
	
	var jsonObj;
	function loadJSON() {
		jsonObj = JSON.parse(jsonString);
		jsonObj.moves.forEach(function(move) {
			createMoveFromJSON(move);
		});
	}
	
	function createMoveFromJSON(m) {
		var newMove = new Move(m.Name, m.Roll, m.AP, m.Effect, m.Range, m.Special, m.Trigger);
		allMoves.push(newMove);
		if (moveLists[m.Class] != null) {
		moveLists[m.Class].push(newMove);
		} else {
		console.log(m.Class + " class could not be identified");
		}
	}
	
	function hideStartingButtons() {
		getById("mainMenu").style.display = "none";
	}
	
	function showLoadingButtons() {
		getById("loadButtons").style.display = "block";
	}
	
	function hideLoadingButtons() {
		getById("loadButtons").style.display = "none";
	}
	
	function resetCharacter() {
		// Fill character skills
		character.attributes["Strength"] = 0;
		character.attributes["Agility"] = 0;
		character.attributes["Intelligence"] = 0;
		character.attributes["Spirit"] = 0;
		
		character.fightingStyles = {
		"Martial Combat" : 0,
		"One Handed Weapons" : 0,
		"Two Handed Weapons": 0,
		"Throwing Weapons" : 0,
		"Marksmanship" : 0,
		"Magic" : 0,
		}
		character.skills = {
		"Alchemy and Cooking" : 0,
		"Smithing and Appraisal" : 0,
		"Survival and Tracking" : 0,
		"Thievery and Sneaking" : 0,
		"Acrobatics and Athletics" : 0,
		"Performance and Bluff" : 0
		}
	}
	
	function loadCharacterFromCookie() {
		for (var i=0; i<cookieList.length; i++) {
			if (cookieList[i].indexOf("character=") > -1) {
				var start = cookieList[i].indexOf("{");
				var end = cookieList[i].length;
				loadCharacterFromString(cookieList[i].substring(start,end));
				break;
			}
		}
	}
	
	function loadCharacterFromString(str) {
		character = JSON.parse(str);
		clearScreens();
		hideStartingButtons();
		console.log("Character Loaded");
		setMyCharacterBox();
		completeCharacter();
		// import moves from string
		character.moves.forEach(function(moveName) {
			for (var i=0; i<allMoves.length; i++) {
				if (allMoves[i].name == moveName) {
					myMoves.push(allMoves[i]);
					break;
				}
			}
		});
		dbg.innerHTML = "loadCharacterFromString run";
		showCharacter();
		listMyMoves();
	}
	
	function setCookieButtonText() {
		// get load button text
			var cName = "";
			var dateString = "";
			for (var i=0; i<cookieList.length; i++) {
				// get characterName
				if (cookieList[i].indexOf("character=") > -1) {
					var end = cookieList[i].length;
					cName = cookieList[i].substring(cookieList[i].indexOf('"name":')+8,end);
					end = cName.indexOf('"');
					cName = cName.substring(0,end); 
					end = cookieList[i].length;
					cookieList[i].indexOf('"lastModified":')
					var start = cookieList[i].indexOf('"lastModified":')+16
					dateString = cookieList[i].substring(start,start + 10);
				}			
			}
			/*console.log(cookieList[0]);
			var tempStr = cookieList[0];
			var end = tempStr.length;
			className = tempStr.substring(tempStr.indexOf('"charClass":')+13,end);
			end = className.indexOf('"');
			className = className.substring(0,end); 
			end = tempStr.length;
			tempStr.indexOf('"lastModified":')
			var start = tempStr.indexOf('"lastModified":')+16
			dateString = tempStr.substring(start,start + 10);
			getById("cookieLoadBtn").innerHTML = className + " on " + dateString;
			*/
			getById("cookieLoadBtn").innerHTML = cName + " on " + dateString;
			if (cName == "") {
				 getById("cookieLoadBtn").innerHTML = "Browser does not have any character data";
			}
	}
	
	function loadCookies() {
		cookieList = [];
		console.log("COOKIE TEXT\n********************\n" + document.cookie);
		if (document.cookie != "" && document.cookie != null) {
			var startInagl = 0;
			// load cookies
			for (var i=0; i<document.cookie.length; i++) {
				if (document.cookie[i] == ";") {
					//console.log("end of cookie found");
					cookieList.push(document.cookie.substring(startInagl,i));
					startInagl = i+1;
				}
			}
			// last cookie may not have semicolon
			if (startInagl+1 < document.cookie.length) {
				cookieList.push(document.cookie.substring(startInagl,document.cookie.length));
			}
		}
	}
	
	function mobileDebug(enabled) {
		if (enabled) {
			window.onerror = function(errorMsg, url, linenumber) { handleErrorMobile(errorMsg, url, linenumber); };
		} else {
			dbg.style.display = "none";
		}
	}
	
	function handleErrorMobile(errorMsg, url, linenumber) {
		dbg.style.display = "block";
		dbg.innerHTML = dbg.innerHTML + "<br>"
		+ errorMsg + ", " + url + ", line# " + linenumber;
	}
	
	function setupCharacterExport() {
		var saveMoveNames = [];
		myMoves.forEach(function(m) {
			saveMoveNames.push(m.name);
		});
		getById("saveArea").style.display = "block";
		getById("saveText").innerHTML = JSON.stringify(character);
	}
	
	function clipboardCopyCharacterText() {
		var text = document.querySelector('#saveText');
		if (document.body.createTextRange) { // ms
			var range = doc.body.createTextRange();
			range.moveToElementText(text);
			range.select();
    	} else if (window.getSelection) { // moz, opera, webkit
			var selection = window.getSelection();            
			var range = document.createRange();
			range.selectNodeContents(text);
			selection.removeAllRanges();
			selection.addRange(range);
        } else {
			var textField = document.createElement('textarea');
			textField.innerText = text.innerHTML;
			document.body.appendChild(textField);
			textField.select();
			document.execCommand('copy');
			textField.remove();
        }
		try {
			var successful = document.execCommand('copy');
			var msg = successful ? 'successful' : 'unsuccessful';
			console.log('Copying text command was ' + msg);
		} catch (err) {
			console.log('Oops, unable to copy');
		}
	}
	
	function setScreenString(screenString) {
		prevScreen = currScreen;
		currScreen = screenString;
		removeClass(getByClass("backButton"),"backDisabled");
		backDisabled = false;
	}
	
	function goBackToPrevScreen() {
		showScreen(prevScreen);
		addClass(getByClass("backButton"),"backDisabled");
		backDisabled = true;
	}
	
	function showScreen(screenString) {
		window.scroll(0,0);
		clearScreens();
		switch(screenString) {
			case "Main Menu":
				getById("mainMenu").style.display = "block";
				break;
			case "Help":
				retractMenu();
				clearScreens();
				getByClass("helpBox").style.display = "block";
				setScreenString("Help");
				break;
			case "Character":
				setMyCharacterBox()
				showCharacter();
				listMyMoves();
				setScreenString("Character");
				break;
			case "All Moves":
				retractMenu();
				clearScreens();
				listMoves("moves");
				setScreenString("All Moves");
				break;
			case "About":
				clearScreens();
				getById("aboutSection").style.display = "block";
				setScreenString("About");
				break;
			case "Character Creation":
				getByClass("characterCreationBox").style.display = "block";
				//getByClass("helpfulHint").style.display = "block";
				presentChoice(choiceNumber);
				hideStartingButtons();
				setScreenString("Character Creation");
				break;
			case "Import":
				hideStartingButtons();
				showLoadingButtons();
				setScreenString("Import");
				break;
			case "Export":
				clearScreens();
				setupCharacterExport();
				setScreenString("Export");
				break;
			case "Combat Example":
				clearScreens();
				getByClass("helpBox").style.display = "block";
				window.scroll(0,0);
				getById("combatExampleH").scrollIntoView(true);
				/*window.scroll(0,6500);*/
				setScreenString("Combat Example");
				break;
			case "Quick Reference":
				clearScreens();
				getByClass("helpBox").style.display = "block";
				window.scroll(0,0);
				getById("quickReference").scrollIntoView(true);
				setScreenString("Quick Reference");
				break;
		}
	}
	
	function startCharacterCreation() {
		clearScreens();
		resetCharacter()
		getByClass("characterCreationBox").style.display = "block";
		//getByClass("helpfulHint").style.display = "block";
		presentChoice(choiceNumber);
		hideStartingButtons();
		setScreenString("Character Creation");
	}
	
	// display definition
	function d(term) {
		var definitionObject = null;
		if (keywords[term] != null) {
			definitionObject = glossary[keywords[term]];
		}
		else {
			glossary.forEach(function(defObj) {
				if (definitionObject == null) {
				if (defObj.Term.toLowerCase() == term.toLowerCase()) {
					definitionObject = defObj;
					//console.log(defObj.Definition);
				}
				}
				/*defObj.Tags.forEach(function(synonym) {
					if (synonym.toLowerCase() == term.toLowerCase()) {
						console.log(defObj.Definition);
					}
				});*/
			});
		}
		if (!definitionObject) { 
			console.log("could not find " + term); 
			return; 
		}
		
		// update history
		glossaryHistory.push(definitionObject.Term);
		
		// set header
		defBox.querySelector(".definitionHeader").innerHTML = definitionObject.Term;
		
		// set body
		defBox.querySelector("p").innerHTML = parseKeywords(definitionObject.Definition);
		showDefinitionBox();
	}
	
	/*function activateKeywords() {
		var keywordElements = document.querySelectorAll(".keyword");
		console.log(keywordElements[0]);
		for (var i=0; i<keywordElements.length; i++) {
			var temp = keywordElements.item(i).innerHTML;
			keywordElements.item(i).onclick = function() { d(temp); }
		};
	}*/
	
	// returns keyword elements in strings containing keywords
	function parseKeywords(htmlString) {
		var newString = htmlString;
		// loop through keywords and variants
		glossary.forEach(function(defObj) {
			newString = parseKeywordsHelper(newString,defObj);
		});
		
		// return parsed string
		return newString;
	}
	
	// loops through list of synonyms, returns parsed string
	function parseKeywordsHelper(htmlString,defObj) {
		// null case
		if (htmlString == null || htmlString == "" || defObj == null) {
			//console.log("this is a test to see that the recursion is working");
			return "";
		}
		
		var lowerString = htmlString.toLowerCase();
		
		// check
		var cont = true;
		var j = 0;
		if (j>=defObj.Tags.length) { cont=false; }
		while (cont) {
			// kill loop if out of range
			if (j>=defObj.Tags.length-1) { cont=false; }
			var tag = defObj.Tags[j];
			//console.log("j: " + j);
			//console.log(defObj.Tags[j]);
			var keyIndex = lowerString.indexOf(tag.toLowerCase());
			// if the term is found
			if (keyIndex >= 0) {
				cont = false;
				return parseKeywordRec(htmlString,tag);
			}
			j++;
		}
		
		// default case
		return htmlString;
	}
	
	// recurses and returns parsed string
	function parseKeywordRec(htmlString, tag) {
		// null case
		if (htmlString == null || htmlString == "" || tag == null) {
			return "";
		}
		// lower
		var lowerString = htmlString.toLowerCase();
		// get index
		var keyIndex = lowerString.indexOf(tag.toLowerCase());
		// if the term is found
		if (keyIndex >= 0) {
		
			if (validKeyword(htmlString, tag, keyIndex)) {
		
			// parse before keyword
			var firstPart = 
			parseKeywordRec(
				htmlString.substring(
					0,
					keyIndex),tag
			);
		
			// add keyword class
			var keyword = "<span class='keyword' onclick='d(\""+tag+"\")'>" 
			+ htmlString.substring(keyIndex,keyIndex+tag.length) 
			+ "</span>";
		
			// onclick links to glossary
			// --- todo ---
		
			// parse after keyword
			var lastPart = 
			parseKeywordRec(
				htmlString.substring(
					keyIndex+tag.length,
					htmlString.length),tag
			);
		
			// since the keyword was found, 
			return firstPart + keyword + lastPart;
			
			}
		}
		return htmlString;
	}
	
	function validKeyword(str, kWord, idx) {
		if (idx > 0) {
			// check if the prev char is in the alphabet
			var prevChar = str.substring(idx-1,idx);
			// if it is, return false
			if ("A" < prevChar && prevChar < "z") {
				return false;
			}
		}
		var end = idx + kWord.length;
		if (end < str.length-2) {
			// check if the next char is in the alphabet
			var nextChar = str.substring(end,end+1);
			// if it is, perform more tests (plurals)
			if ("A" < nextChar && nextChar < "z") {
				// simple plural
				if (nextChar == "s") {
					return true;
				}
				// "es" plural
				if (nextChar == "e" && end < str.length-3) {
					if (str.substring(end,end+2) == "es") {
						return true;
					}
				}
				// otherwise return false
				return false;
			}
		}
		return true;
	}
	
	function showDefinitionBox() {
		defBox.style.bottom = "-2em";
	}
	
	function hideDefinitionBox() {
		defBox.style.bottom = "-30em";
	}
	
	// uses the glossary to fill the data structure
	function populateKeywords() {
		var n=0; 
		glossary.forEach(function(kWord) {
			for (k=0; k<kWord.Tags.length; k++) {
				keywords[kWord.Tags[k]] = n;
			}
			n++;
		});
	}
	
	var turn;
	// activates the battle mode
	function enterBattleMode(myTurn) {
		if (myTurn) {
			setAP(5);
		} else {
			setAP(10);
		}
		setHP(archetypes[character.charClass].HP);
		turn = myTurn;
		getByClass("battleHUD").style.display = "block";
		getByClass("initiativeButtons").style.display = "none";
	}
	
	function setHP(val) {
		HP = val;
		getByClass("HPCounter").innerHTML = HP + " HP";
	}
	
	function Collapser(container, clickElem, innerElem) {
		this.uniqueId = container.id;
		this.container = container;
		this.clickElem = clickElem;
		this.innerElem = innerElem;
		this.expanded = false;
		this.toggle = function() {
			if (this.expanded) {
				window.scrollBy(0,-1*innerElem.clientHeight);
				this.expanded = false;
				this.innerElem.style.height = '0'
				this.innerElem.style.overflow = "hidden";
			} else {
				this.innerElem.style.height = 'auto'
				this.expanded = true;
				window.scrollBy(0,innerElem.clientHeight);
			}
		}
		this.clickElem.onclick = function(event) {
			console.log(event.currentTarget.id);
			collapserObjects[event.currentTarget.id].toggle();
		}
	}
	
	// on clicks
	getByClass("characterBtn").onclick = function() {
		retractMenu();
    	showScreen("Character");
	};
	getByClass("helpBtn").onclick = function() {
		retractMenu();
    	showScreen("Help");
	};
    getByClass("mainMenuBtn").onclick = function() {
		retractMenu();
		showScreen("Main Menu");
	};
    getByClass("allMovesBtn").onclick = function() {
    	retractMenu();
    	showScreen("All Moves");
    };
    getByClass("resetBtn").onclick = function () {
    	resetAP();
    };
    getByClass("plusOneBtn").onclick = function () {
    	addToAP(1);
    };
    getByClass("minusOneBtn").onclick = function () {
    	addToAP(-1);
    };
    getByClass("bottomBar").onclick = function () {
    	retractUseBox();
    };
    getByClass("optionsBtn").onclick = function() {
    	extendMenu();
    };
    getByClass("threeBars").onclick = function() {
    	extendMenu();
    };
    getByClass("hideBtn").onclick = function() {
    	retractMenu();
    };
    getByClass("backButton").onclick = function() {
		goBackToPrevScreen();
	}
    getById("aboutBtn").onclick = function() {
    	clearScreens();
    	showScreen("About");
    };
	getById("loadBtn").onclick = function() {
		showScreen("Import");
	};
	getById("textLoadBtn").onclick = function() {
		hideLoadingButtons();
		//console.log(document.querySelector("textarea").value);
		loadCharacterFromString(document.querySelector("textarea").value);
	};
	getById("cookieLoadBtn").onclick = function() {
		hideLoadingButtons();
		loadCharacterFromCookie();
	};
	getById("done").onclick = function() {
		deleteDuplicateButtons();
		addToCharacter();
		if (choiceNumber >= lastChoice) {
			closeCreator();
			clearMoves();
			showCharacter();
			listMyMoves();
			return;
		}
		advanceQuestion();	
	};
	getById("ccStartBtn").onclick = function() {
		startCharacterCreation();
	};
	getById("saveBtn").onclick = function() {
		showScreen("Export");
	};
	getById("clipboardBtn").onclick = function() {
		clipboardCopyCharacterText();
	};
	getById("helpLink").onclick = function() {
		clearScreens();
		getByClass("helpBox").style.display = "block";
		window.scroll(0,0);
		setScreenString("Help");
	};
	getById("combatExampleLink").onclick = function() {
		showScreen("Combat Example");
	};
	getById("quickReferenceLink").onclick = function() {
		showScreen("Quick Reference");
	};
	getById("closeDefBox").onclick = function() {
		hideDefinitionBox();
	}
	getById("defBack").onclick = function() {
		// if there are entries
		if (glossaryHistory.length > 1) {
			glossaryForward.push(glossaryHistory.pop()); // move from back to forward
			d(glossaryHistory.pop()); // this adds to history
		}
	}
	getById("defFwd").onclick = function() {
		// if there are entries
		if (glossaryForward.length > 0) {
			d(glossaryForward.pop()); // this adds to history
		}
	}
	getById("IAttack").onclick = function() {
		enterBattleMode(true);
	}
	getById("GotAttacked").onclick = function() {
		enterBattleMode(false);
	}
	getById("HPplus").onclick = function() {
		setHP(HP+1);
	}
	getById("HPminus").onclick = function() {
		setHP(HP-1);
	}
	getById("NextTurn").onclick = function() {
		var newAP = AP + 5;
		if (newAP > maxAP) { newAP = maxAP; }
		setAP(newAP);
	}
	
	window.onbeforeunload = function() { return "Are you sure you want to leave? All unsaved progress will be lost."; }
	
	function init() {
		mobileDebug(true);
		loadJSON();
		loadCookies();
		setCookieButtonText();
		clearMoves();
		populateKeywords();
	}
	init();
	
	</script>
</html>